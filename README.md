# è¯´æ˜

å®‰è£…
```bash
npm install
```
or
```bash
yarn
```
é¡¹ç›®ä½¿ç”¨umiè„šæ‰‹æ¶åˆ›å»ºçš„ï¼Œä½¿ç”¨çš„æ˜¯Ant Design Proæ¨¡æ¿ã€‚
å¯åŠ¨çš„æ—¶å€™å¯èƒ½ä¼šåŒ…bableçš„ç‰ˆæœ¬é”™è¯¯ï¼Œæœä¸€ä¸‹æ¢ä¸ªç‰ˆæœ¬å°±å¥½äº†ï¼Œç¯å¢ƒStartï¼Œå“ˆå“ˆã€‚

[æ¼”ç¤ºåœ°å€](https://nihaojob.github.io/DragLayout/)

### åæ€
è¿™æ˜¯ä¸€ä¸ªç¬¨æ‹™çš„æ•°æ®ç»“æ„ï¼Œä½ ä¼šå‘ç°å¦‚æœä½¿ç”¨reactæ¥å¯¹treeè¿›è¡Œæ¸²æŸ“å’Œå¼€å‘æ—¶ï¼Œæ€§èƒ½å°†æˆä¸ºä¸€ä¸ªç“¶é¢ˆã€‚

### å®ç°æ€è·¯

ç°åœ¨æœ‰å¾ˆå¤šä¼˜ç§€çš„æ‹–æ‹½å¸ƒå±€å·¥å…·ï¼Œ[è¡¨å•è®¾è®¡å™¨](http://tools.xiaoyaoji.cn/form/#/)ï¼Œ[layuiæ‹–æ‹½å¸ƒå±€](http://lowcode.magicalcoder.com/layui), [Vue-Layout](https://jaweii.github.io/Vue-Layout/dist/#/)ã€‚

æˆ‘ä»¬æœ€è¿‘ä¹Ÿå®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæŠŠé¢„è§ˆè´´å‡ºæ¥ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆæ˜é‡‘ç°åœ¨å›¾ç‰‡ä¸æ”¯æŒgifäº†ï¼Œè¿˜è¦è‡ªå·±ä¸Šä¼ åˆ°å›¾åºŠï¼‰ã€‚

![](https://user-gold-cdn.xitu.io/2019/10/20/16de6cc8698acd56?w=1121&h=584&f=gif&s=397631)
![](https://user-gold-cdn.xitu.io/2019/10/20/16de6cd0ee554ebd?w=1121&h=584&f=gif&s=351009)
![](https://user-gold-cdn.xitu.io/2019/10/20/16de6cd95e45b824?w=1121&h=584&f=gif&s=217033)

åœ¨å®ç°è¿™ä¸ªçš„åŠŸèƒ½çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿèµ°äº†ä¸€ç‚¹å¼¯è·¯ï¼Œæˆ‘ä»¬å†…éƒ¨1.0ç‰ˆæœ¬çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯`sortablejs`ï¼Œç”±äºä»£ç å†™çš„æ¯”è¾ƒæ··ä¹±ï¼Œæ‹–æ‹½åŠŸèƒ½ç»å¸¸å‡ºç°å¡æ­»çš„ç°è±¡ï¼Œä»¥ä¸ºæ˜¯`sortablejs`çš„é—®é¢˜ï¼Œç„¶ååˆæ¢æˆå¤§åé¼é¼çš„`React Dnd`ï¼Œå’Œ`Redux`æ˜¯åŒä¸€ä¸ªä½œè€…ï¼Œä½†æ˜¯Dndå¹¶ä¸æ˜¯å¤ªç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‹–æ‹½çš„APIç¡®å®å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯æ’åºã€è·¨çº§æ‹–æ‹½ç­‰å¥½å¤šåŠŸèƒ½éƒ½è¦è‡ªå·±æ‰‹åŠ¨å®ç°ï¼Œåœ¨å®ç°å®Œè·¨çº§æ‹–æ‹½ä»¥åï¼Œè€å¤§è®©æˆ‘æ¢æˆäº†`sortablejs`ã€‚

æ‹–æ‹½å·¥å…·ï¼š[sortablejs](http://sortablejs.github.io/Sortable/)
ï¼Œ[React Dnd](http://react-dnd.github.io/react-dnd/)

æˆ‘ä»¬è¿˜æ˜¯å…ˆè¯´ä¸‹æ€è·¯ï¼Œè¿˜æœ‰æˆ‘ä»¬åœ¨1.0é‡Œç»™è‡ªå·±æŒ–çš„å‘ï¼Œä½ ä»¬ä¹Ÿè¦å°å¿ƒå“ˆğŸ˜‚ã€‚

å¦‚æœæœ‰è¿‡æ ‘ç»„ä»¶å¼€å‘ç»éªŒçš„å°ä¼™ä¼´ï¼Œåº”è¯¥å¯¹**é€’å½’**å¾ˆç†Ÿæ‚‰äº†ï¼Œå·¦ä¾§çš„é¡µé¢ç»“æ„è¦ç”¨åˆ°ï¼Œå³ä¾§çš„æ¸²æŸ“ä¹Ÿè¦ç”¨åˆ°ï¼Œæ•´ä½“æ¥è¯´ï¼Œå·¦ä¾§çš„ç»„ä»¶æ ‘å’Œå³ä¾§çš„ç”»å¸ƒåŒºï¼Œå°±æ˜¯ä¸¤ä¸ªé€’å½’å‡½æ•°ã€‚

### é¡µé¢å³æ•°ç»„ï¼Œç»„ä»¶å³å¯¹è±¡
æˆ‘ä»¬è¦ç”Ÿæˆé¡µé¢ï¼Œè‚¯å®šä¸æ˜¯åªçœ‹çœ‹é¡µé¢é•¿ä»€ä¹ˆæ ·å­ï¼Œå¥½ä¸å¥½çœ‹ï¼Œè€Œæ˜¯è¦æŠŠæ•°æ®ä¿å­˜èµ·æ¥ï¼Œç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ï¼Œé¦–å…ˆå°±è¦é¢ä¸´çš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªæ•°æ®åº”è¯¥é•¿ä»€ä¹ˆæ ·å­ï¼Œéƒ½æœ‰å“ªäº›å­—æ®µï¼Œåˆ†åˆ«å¹²ä»€ä¹ˆç”¨ã€‚

é¡µé¢å³æ•°ç»„å¾ˆå¥½ç†è§£ï¼Œä¸€ä¸ªé¡µé¢ä¸Šå¯ä»¥æœ‰å¤šä¸ªç»„ä»¶ï¼Œè€Œä¸”æœ‰é¡ºåºï¼Œç”¨æ•°ç»„å°±æ¯”è¾ƒæ–¹ä¾¿äº†ï¼Œå¦‚æœæœ‰å­å…ƒç´ æ€ä¹ˆåŠï¼Œä¸ç®¡vueè¿˜æ˜¯reactï¼ŒUIæ¡†é‡Œéƒ½ä¼šæœ‰`Tree`ç»„ä»¶ï¼Œæ•°æ®æ ¼å¼éƒ½æ˜¯ä½¿ç”¨`children`å‘ä¸‹åµŒå¥—æ•°æ®ç»„ï¼Œè¿™ç‚¹å¥½ç†è§£å§ï¼Ÿ

ä¸¾ä¸ªæ —å­ï¼Œiviewçš„treeç»„ä»¶[æ–‡æ¡£](https://www.iviewui.com/components/tree)
![](https://user-gold-cdn.xitu.io/2019/10/20/16de6e99d8026311?w=2116&h=1566&f=png&s=195924)

å­å…ƒç´ å’Œæˆ‘ä»¬æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Œæˆ‘ä»¬çœ‹[è¡¨å•è®¾è®¡å™¨](http://tools.xiaoyaoji.cn/form/#/)å’Œ[layuiæ‹–æ‹½å¸ƒå±€](http://lowcode.magicalcoder.com/layui)é‡Œï¼Œéƒ½æœ‰**å®¹å™¨ç»„ä»¶**ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Œå°±æ˜¯å¯ä»¥åœ¨è¿™ä¸ªç»„ä»¶ä¸‹ç»§ç»­æ‹–æ‹½æ”¾å…¥ç»„ä»¶ï¼Œå¦‚æœæ•°æ®æ— é™çš„å‘ä¸‹å»¶ä¼¸ï¼Œé‚£å°±éœ€è¦`children`å¸®å¿™å‘ä¸‹æ— é™åµŒå¥—ã€‚

![](https://user-gold-cdn.xitu.io/2019/10/20/16de6f06476e553b?w=1332&h=1322&f=png&s=227412)

![](https://user-gold-cdn.xitu.io/2019/10/20/16de6f163e826a9f?w=1726&h=1324&f=png&s=187847)

åµŒå¥—çš„é—®é¢˜è§£å†³äº†ï¼Œç»„ä»¶æ€ä¹ˆæ¸²æŸ“å‘¢ï¼Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘æ‹–æ‹½çš„é—®é¢˜ï¼Œå•å•ä¸€ä¸ªæ•°æ®å¯¹è±¡æ¸²æŸ“æˆç»„ä»¶ï¼Œæ€ä¹ˆå®ç°å‘¢ï¼Ÿ
å…ˆå¤§è‡´æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¦‚æœä½¿ç”¨`Ant Design`çš„ç»„ä»¶ï¼Œæˆ‘ä»¬å¾—çŸ¥é“ç»„ä»¶çš„åç§°å§ï¼Ÿå¾—æœ‰è‡ªå·±`props`å§ï¼Ÿ
æš‚å®šä¸¤ä¸ªå­—æ®µ`name`å’Œ`attr`ï¼ŒåŒ…æ‹¬ä¸Šé¢æåˆ°çš„`children`å­—æ®µï¼Œæˆ‘ä»¬å…ˆç®€å•çš„åšä¸ªdemoï¼Œç”¨antçš„æ¨¡æ¿ã€‚


```js
import React, { Component } from 'react';
import { Rate,Input,DatePicker } from 'antd';
const { MonthPicker, RangePicker, WeekPicker } = DatePicker;

const GlobalComponent = {
    Rate,
    Input,
    MonthPicker,
    RangePicker,
    WeekPicker,
}


class EditPage extends Component {

    render() {
        
        // æµ‹è¯•æ•°æ®
        const Data = [
            {
                name: 'Input',
                attr: {
                    size:'large',
                    value:'ç¬¬ä¸€ä¸ª'
                }
            },
            {
                name: 'Input',
                attr: {
                    size:'default',
                    value:'ç¬¬äºŒä¸ª'
                }
            },
            {
                name: 'Input',
                attr: {
                    size:'small',
                    value:'ç¬¬ä¸‰ä¸ª'
                }
            },
            {
                name: 'Containers',
                attr: {
                    style:{
                        border:'1px solid red'
                    }
                },
                children:[
                    {
                        name: 'Input',
                        attr: {
                            size:'small',
                            value:'åµŒå¥—çš„input'
                        }
                    },
                    {
                        name: 'Rate',
                        attr: {
                            size:'small',
                            value:'åµŒå¥—çš„input'
                        }
                    },
                    {
                        name: 'MonthPicker',
                        attr: {}
                    },
                    {
                        name: 'RangePicker',
                        attr: {}
                    },
                    {
                        name: 'WeekPicker',
                        attr: {}
                    },
                ]

            },
        ];
        
        // é€’å½’å‡½æ•°
        const loop = (arr) => (
            arr.map(item => {
                if(item.children){
                    return <div {...item.attr} >{loop(item.children)}</div>
                }
                const ComponentInfo = GlobalComponent[item.name]
                return <ComponentInfo {...item.attr} />
            })
        );

        return (
            <>
                {loop(Data)}
            </>
        );
    }
}

export default EditPage;

```

é¡µé¢å·²ç»æ¸²æŸ“å‡ºæ¥äº†ï¼Œæ€ä¹ˆæ · å¾ˆç®€å•å§ï¼Ÿ æ¥ä¸‹æ¥ æˆ‘ä»¬ä¸€èµ·æ¥å®ç°æ‹–æ‹½å§

![](https://user-gold-cdn.xitu.io/2019/10/20/16de756a1de2405f?w=2610&h=850&f=png&s=75190)

### æ‹–æ‹½çš„å®ç°
æ•°æ®æ ¼å¼æˆ‘ä»¬æœ‰äº†ï¼Œæ¸²æŸ“ä¹Ÿå®ç°äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ‹–æ‹½äº†ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹äº†[sortablejs](http://sortablejs.github.io/Sortable/)è¿™ä¸ªæ’ä»¶ï¼Œå®˜æ–¹æœ‰æä¾›`react`ç‰ˆçš„ç»„ä»¶`react-sortablejs`ã€‚

å®‰è£…ä¾èµ–ï¼Œåœ¨é¡µé¢ä¸­å¼•å…¥ç»„ä»¶ï¼Œä¸å¤šè¯´ï¼Œçœ‹[react-sortablejsæ–‡æ¡£](https://github.com/SortableJS/react-sortablejs)ã€‚

æ¥ä¸‹æ¥å…ˆè¯´ä¸€ä¸‹`sortablejs`**æä¾›ç»™æˆ‘ä»¬ä»€ä¹ˆåŠŸèƒ½**ã€‚

1. å¦‚æœä»å®¹å™¨Aæ‹–æ‹½åˆ°å®¹å™¨Bï¼Œä¸¤ä¸ªå®¹å™¨`group`å‚æ•°çš„`name`ä¿æŒä¸€è‡´æ‰èƒ½å®ç°ç›¸äº’æ‹–æ‹½ã€‚
2. å®¹å™¨æ˜¯å¦å¯ç§»å…¥å’Œç§»å‡ºï¼Œæ˜¯åœ¨`group`ä¸­é…ç½®`pull`å’Œ`put`å±æ€§ã€‚
3. å®¹å™¨æœ‰ä¸¤ä¸ªç›‘å¬äº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯ç§»å…¥çš„`onAdd`æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æ›´æ–°çš„`onUpdate`æ–¹æ³•
4. `onAdd`å’Œ`onUpdate`åªèƒ½ç›‘å¬åˆ°æ‹–æ‹½å…ƒç´ çš„`data-id`å±æ€§

æˆ‘ä»¬æ€ä¹ˆå€ŸåŠ©è¿™äº›åŠŸèƒ½å®ç°ï¼Ÿ
1. ç»„ä»¶åˆ—è¡¨ï¼Œå°±æ˜¯å·¦ä¾§ä¾›æˆ‘ä»¬æ‹–æ‹½çš„æºç»„ä»¶åˆ—è¡¨ï¼Œä¸èƒ½ç§»å‡ºï¼Œå¹¶ä¸”`data-id`éœ€è¦ä¸ºç»„ä»¶åç§°ï¼Œæ‰èƒ½å‘ŠçŸ¥å³ä¾§çš„å®¹å™¨æ‹–æ‹½è¿›å…¥çš„æ˜¯ä»€ä¹ˆç»„ä»¶ã€‚
2. å³ä¾§å®¹å™¨éœ€è¦åµŒå¥—ï¼Œé€’å½’å±•ç¤ºï¼Œæœ‰å­å…ƒç´ æ—¶è¦å±•ç¤ºå®¹å™¨è€Œä¸æ˜¯ç»„ä»¶ã€‚
3. å³ä¾§çš„å®¹å™¨è¦å¯ç§»å…¥ç§»å‡ºï¼Œæ–¹ä¾¿è·¨å®¹å™¨æ‹–æ‹½ã€‚
4. ä¸ºäº†æŠŠæ–°å¢çš„ç»„ä»¶æ•°æ®æ”¾è¿›å³ä¾§å¯¹åº”çš„ä½ç½®ï¼Œå³ä¾§å®¹å™¨çš„`data-id`ä¿®æ”¹ä¸ºä¸‹æ ‡çš„è·¯å¾„`2-3-2`è¿™æ ·çš„å½¢å¼ï¼Œå¯¹åº”æ ¹æ•°ç»„çš„ç¬¬2ä¸ªå…ƒç´ çš„ç¬¬3ä¸ªå­å…ƒç´ çš„ç¬¬2ä¸ªå­å…ƒç´ ã€‚

å¥½äº†ï¼Œç°åœ¨å…ˆæŠŠä¾›æˆ‘ä»¬æ‹–æ‹½çš„æºç»„ä»¶åˆ—è¡¨å†™å‡ºæ¥

ç„¶åæŠŠå³ä¾§çš„å®¹å™¨æ”¹é€ ä¸€ä¸‹ï¼Œå¦‚æœæœ‰å­å…ƒç´ åˆ™å±•ç¤ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå¹¶ä¸”åŠ ä¸Šaddçš„ç›‘å¬æ–¹æ³•ã€‚

![](https://user-gold-cdn.xitu.io/2019/10/20/16de8bd55d219032?w=1046&h=549&f=gif&s=755753)
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè·¨çº§æ‹–æ‹½çš„æ—¶å€™è§¦å‘`onAdd`ï¼Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹è¿›å…¥çš„`data-id`åˆ°åº•æ˜¯ä¸‹æ ‡è¿˜æ˜¯ç»„ä»¶ï¼Œå¦‚æœä¸ºç»„ä»¶ç›´æ¥æ·»åŠ ï¼Œå¦‚æœä¸ºä¸‹æ ‡ï¼Œåˆ™**å¯¹æ¯”ä¸€ä¸‹æ–°å¢å’Œåˆ é™¤çš„è·¯å¾„ï¼Œå…ˆæ“ä½œé ä¸‹æ–¹çš„è·¯å¾„ï¼Œå†æ“ä½œé ä¸Šçš„è·¯å¾„**ã€‚

``` js
import React, { Component } from 'react';
import { Rate,Input,DatePicker,Tag } from 'antd';
import Sortable from 'react-sortablejs';
import uniqueId from 'lodash/uniqueId';
const { MonthPicker, RangePicker, WeekPicker } = DatePicker;
import { indexToArray, getItem, setInfo, isPath, getCloneItem, itemRemove, itemAdd } from './utils';
import find from 'find-process';
const GlobalComponent = {
    Rate,
    Input,
    MonthPicker,
    RangePicker,
    WeekPicker,
}


const soundData = [
    {
        name: 'MonthPicker',
        attr: {}
    },
    {
        name: 'RangePicker',
        attr: {}
    },
    {
        name: 'WeekPicker',
        attr: {}
    },
    {
        name: 'Input',
        attr: {
            size:'large',
            value:'ç¬¬ä¸€ä¸ª'
        }
    },
    {
        name: 'Containers',
        attr: {
            style:{
                border:'1px solid red'
            }
        },
    }
]

class EditPage extends Component {

    constructor(props) {
        super(props);
        this.state = {
            Data:[{
                name: 'Input',
                attr: {
                    size:'large',
                    value:'ç¬¬ä¸€ä¸ª'
                } 
            }],
        };
    }

     // æ‹–æ‹½çš„æ·»åŠ æ–¹æ³•
     sortableAdd = evt => {
        // ç»„ä»¶åæˆ–è·¯å¾„
        const nameOrIndex = evt.clone.getAttribute('data-id');
        // çˆ¶èŠ‚ç‚¹è·¯å¾„
        const parentPath = evt.path[1].getAttribute('data-id');
        // æ‹–æ‹½å…ƒç´ çš„ç›®æ ‡è·¯å¾„
        const { newIndex } = evt;
        // æ–°è·¯å¾„ ä¸ºæ ¹èŠ‚ç‚¹æ—¶ç›´æ¥ä½¿ç”¨index
        const newPath = parentPath ? `${parentPath}-${newIndex}` : newIndex;
        // åˆ¤æ–­æ˜¯å¦ä¸ºè·¯å¾„ è·¯å¾„æ‰§è¡Œç§»åŠ¨ï¼Œéè·¯å¾„ä¸ºæ–°å¢
        if (isPath(nameOrIndex)) {
            // æ—§çš„è·¯å¾„index
            const oldIndex = nameOrIndex;
            // å…‹éš†è¦ç§»åŠ¨çš„å…ƒç´ 
            const dragItem = getCloneItem(oldIndex, this.state.Data)
            // æ¯”è¾ƒè·¯å¾„çš„ä¸Šä¸‹ä½ç½® å…ˆæ‰§è¡Œé ä¸‹çš„æ•°æ® å†æ‰§è¡Œè€ƒä¸Šæ•°æ®
            if (indexToArray(oldIndex) > indexToArray(newPath)) {
                // åˆ é™¤å…ƒç´  è·å¾—æ–°æ•°æ®
                let newTreeData = itemRemove(oldIndex, this.state.Data);
                // æ·»åŠ æ‹–æ‹½å…ƒç´ 
                newTreeData = itemAdd(newPath, newTreeData, dragItem)
                // æ›´æ–°è§†å›¾
                this.setState({Data:newTreeData})
                return
            }
            // æ·»åŠ æ‹–æ‹½å…ƒç´ 
            let newData = itemAdd(newPath, this.state.Data, dragItem)
            // åˆ é™¤å…ƒç´  è·å¾—æ–°æ•°æ®
            newData = itemRemove(oldIndex, newData);

            this.setState({Data:newData})
            return
        }

        // æ–°å¢æµç¨‹ åˆ›å»ºå…ƒç´  => æ’å…¥å…ƒç´  => æ›´æ–°è§†å›¾
        const id = nameOrIndex
        
        const newItem = _.cloneDeep(soundData.find(item => (item.name === id)))
        
        // ä¸ºå®¹å™¨æˆ–è€…å¼¹æ¡†æ—¶å¢åŠ å­å…ƒç´ 
        if ( newItem.name === 'Containers') {
            const ComponentsInfo = _.cloneDeep(GlobalComponent[newItem.name])
            // åˆ¤æ–­æ˜¯å¦åŒ…å«é»˜è®¤æ•°æ®
            newItem.children = []
        }
        
        let Data = itemAdd(newPath, this.state.Data, newItem)
        
        this.setState({Data})
    }

    render() {
        
        // é€’å½’å‡½æ•°
        const loop = (arr,index) => (
            arr.map((item,i) => {
                const indexs = index === '' ? String(i) : `${index}-${i}`;
                if(item.children){
                    return <div {...item.attr} 
                        data-id={indexs}
                    >
                        <Sortable
                            key={uniqueId()}
                            style={{
                                minHeight:100,
                                margin:10,
                            }}
                            ref={c => c && (this.sortable = c.sortable)}
                            options={{
                                ...sortableOption,
                                // onUpdate: evt => (this.sortableUpdate(evt)),
                                onAdd: evt => (this.sortableAdd(evt)),
                            }}
                        >
                            {loop(item.children,indexs)}
                        </Sortable>
                    </div>
                }
                const ComponentInfo = GlobalComponent[item.name]
                return <div data-id={indexs}><ComponentInfo {...item.attr} /></div>
            })
        )

        const sortableOption = {
            animation: 150,
            fallbackOnBody: true,
            swapThreshold: 0.65,
            group: {
                name: 'formItem',
                pull: true,
                put: true,
            },
        }

        return (
            <>  
                <h2>ç»„ä»¶åˆ—è¡¨</h2>
                <Sortable
                    options = {{
                            group:{
                                name: 'formItem',
                                pull: 'clone',
                                put: false,
                            },
                            sort: false,
                        }}
                >
                    {
                        soundData.map(item => {
                            return <div data-id={item.name}><Tag>{item.name}</Tag></div>
                        })
                    }
                </Sortable>
                <h2>å®¹å™¨</h2>
                <Sortable
                    ref={c => c && (this.sortable = c.sortable)}
                    options={{
                        ...sortableOption,
                        // onUpdate: evt => (this.sortableUpdate(evt)),
                        onAdd: evt => (this.sortableAdd(evt)),
                    }}
                    key={uniqueId()}
                >
                    {loop(this.state.Data,'')}
                </Sortable>
            </>
        );
    }
}

export default EditPage;
```

ç°åœ¨è·¨çº§æ“ä½œå’Œæ–°å¢å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¡¥å……ä¸€ä¸‹åŒçº§äº¤æ¢ä½ç½®çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ç”¨äº†`immutability-helper`è¿™ä¸ªå·¥å…·å‡½æ•°ï¼Œå…·ä½“çš„è‡ªå·±çœ‹æ–‡æ¡£å§ï¼Œåªæ˜¯ç”¨åˆ°äº†æ•°ç»„æ¢ä½ã€‚

```js
import update from 'immutability-helper'

// æ‹–æ‹½çš„æ’åºæ–¹æ³•
sortableUpdate = evt => {
    // äº¤æ¢æ•°ç»„
    const { newIndex, oldIndex } = evt;

    // çˆ¶èŠ‚ç‚¹è·¯å¾„
    const parentPath = evt.path[1].getAttribute('data-id');

    // çˆ¶å…ƒç´  æ ¹èŠ‚ç‚¹æ—¶ç›´æ¥è°ƒç”¨data
    let parent = parentPath ? getItem(parentPath, this.state.Data) : this.state.Data;
    // å½“å‰æ‹–æ‹½å…ƒç´ 
    const dragItem = parent[oldIndex];
    // æ›´æ–°åçš„çˆ¶èŠ‚ç‚¹
    parent = update(parent, {
        $splice: [[oldIndex, 1], [newIndex, 0, dragItem]],
    });

    // æœ€æ–°çš„æ•°æ® æ ¹èŠ‚ç‚¹æ—¶ç›´æ¥è°ƒç”¨data
    const Data = parentPath ? setInfo(parentPath, this.state.Data, parent) : parent
    // è°ƒç”¨çˆ¶ç»„ä»¶æ›´æ–°æ–¹æ³•
    this.setState({Data})
}
```
ç°åœ¨è·¨çº§å’ŒåŒçº§çš„æ’åºçš„åŠŸèƒ½éƒ½å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬çœ‹çœ‹é¢„è§ˆå›¾å§ã€‚

![](https://user-gold-cdn.xitu.io/2019/10/20/16de8cab1fc829e4?w=1046&h=549&f=gif&s=805784)

åœ¨`onUpdate`å’Œ`onAdd`çš„å‡½æ•°ä¸­ï¼Œè‡ªå·±å°è£…äº†ä¸€äº›æ ¹æ®ä¸‹æ ‡æ“ä½œæ•°ç»„çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯æŒ‰ç…§å‡½æ•°å¼çš„æ–¹å¼ï¼Œæ¯ä¸ªå‡½æ•°è¿”å›æ–°çš„ç»“æœï¼Œå†™çš„ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œå¤šå¤šè§è°…å“ˆï¼Œå‰©ä¸‹çš„åˆ é™¤ã€é€‰ä¸­å•¦ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚å¢åŠ åŠŸèƒ½å°±å¯ä»¥äº†ï¼Œæˆ‘æŠŠæºç æ”¾åœ¨äº†githubä¸Šï¼Œæœ‰éœ€è¦çš„æ‹¿å»å§ï¼Œç å­—ç åˆ°æ‰‹é…¸ï¼Œåƒé¥­å»äº†ğŸ˜‚ã€‚











